# SNR 15dB + k=5 + 거리 0.4m 학습 (도메인 적응 균형 기준)

## 📋 **실험 개요**
- **목적**: 도메인 차이를 고려한 균형잡힌 중간 지점 설정
- **배경**: SNR 분포 분석 결과 bokdo3 데이터에 적합한 15dB 임계값 적용

## ⚙️ **모델 파라미터**
| 파라미터 | 값 | 선택 이유 |
|---------|-----|----------|
| **SNR 임계값** | 15.0 dB | 도메인 적응 (v2: 25.3dB, bokdo3: 20.9dB) |
| **거리 임계값** | 0.4 m | 중간 지점 (0.3m과 0.5m 사이) |
| **k-NN 연결** | 5개 | 균형잡힌 이웃 영향 (4개와 8개 사이) |
| **학습 에포크** | 50 | 기본 설정 |
| **배치 크기** | 16 | 기본 설정 |
| **학습률** | 0.005 | Adam 옵티마이저 |

## 📊 **학습 결과**
- **최고 검증 정확도**: 77.38%
- **실제 타겟 비율**: 29.6% (19,310개)
- **고스트 타겟 비율**: 70.4% (45,878개)
- **총 그래프**: 2,090개
- **총 노드**: 65,188개

## 📁 **파일 구조**
```
SNR_15dB_k5_0.4m_training/
├── ghost_detector_k5_15dB_0.4m.py     # 균형잡힌 학습 스크립트
├── ghost_detector_k5_15dB_0.4m.pth    # 학습된 모델 (77.38% 정확도)
├── balanced_training_analysis.png      # 균형잡힌 학습 데이터 분석
├── hybrid_ghost_gnn.py                # GNN 모델 정의
├── data_structures.py                 # 데이터 구조 정의
├── RadarMap_v2.txt                   # 학습용 레이더 데이터
├── LiDARMap_v2.txt                   # 학습용 LiDAR 데이터
└── requirements.txt                  # 패키지 의존성
```

## 🎯 **도메인 적응 라벨링 규칙**
```python
if distance <= 0.4m AND snr >= 15.0dB:  # 도메인 적응 기준
    label = 1  # 실제 타겟
else:
    label = 0  # 고스트 타겟
```

## 🎨 **학습 데이터 시각화**

### 📊 **balanced_training_analysis.png**
4패널 구성으로 균형잡힌 기준 분석:
1. **원본 데이터**: LiDAR + Radar (SNR 색상)
2. **균형잡힌 라벨링**: k=5, 15dB, 0.4m 기준 적용
3. **거리 분포**: 0.4m vs 다른 임계값들 비교 히스토그램
4. **통계 정보**: 도메인 적응 효과 및 균형점 분석

## 🚀 **사용법**
```bash
# 균형잡힌 학습 실행
python3 ghost_detector_k5_15dB_0.4m.py

# GPU 환경 확인
python3 -c "import torch; print(f'CUDA: {torch.cuda.is_available()}')"
```

## 📈 **성능 분석**

### 📊 **도메인 적응 효과**
| 지표 | 기존 20dB | 개선 17.5dB | **균형 15dB** | 완화 10dB |
|------|----------|------------|-------------|----------|
| **학습 정확도** | 94.42% | 96.6% | **77.38%** | 91.34% |
| **실제 타겟 비율** | 21.3% | 24.3% | **29.6%** | 35.1% |
| **도메인 적합성** | 낮음 | 보통 | **높음** | 과도함 |

### ✅ **균형잡힌 설정의 장점**
1. **도메인 적응**: bokdo3 평균 SNR(20.9dB)에 맞춘 15dB 임계값
2. **중간 지점**: 모든 파라미터가 극단을 피한 균형점
3. **실용적 성능**: 29.6% 실제 타겟으로 적절한 보존율
4. **LiDAR 인접 보존**: 15dB로 인해 더 많은 인접 레이더 보존

### 🎯 **파라미터 선택 근거**

#### **SNR 15dB 선택**:
- **v2 데이터**: 평균 25.3dB → 15dB에서 77.6% 보존
- **bokdo3 데이터**: 평균 20.9dB → 15dB에서 77.6% 보존
- **도메인 갭**: 4.4dB 차이를 고려한 적응적 임계값

#### **거리 0.4m 선택**:
- **0.3m**: 너무 엄격 (LiDAR 인접도 고스트 판정)
- **0.5m**: 너무 관대 (멀리 떨어진 것도 실제 판정)
- **0.4m**: 센서 오차 고려한 실용적 중간점

#### **k=5 선택**:
- **k=8**: 과도한 이웃 의존 (98.9% Real)
- **k=4**: 너무 개별적 판단
- **k=5**: 적절한 이웃 영향과 개별 판단 균형

## 🔍 **도메인 차이 해결**
### **문제 상황**:
```
LiDAR 바로 옆 레이더: 거리 0.2m, SNR 16dB
기존 20dB 기준: ❌ (16dB < 20dB) → 고스트 분류
균형 15dB 기준: ✅ (16dB ≥ 15dB) → 실제 분류
```

### **해결 효과**:
- LiDAR 인접 레이더 포인트의 적절한 보존
- 도메인 갭으로 인한 성능 저하 완화
- 실제 환경에 더 적합한 임계값

## 🏆 **결론**
SNR 15dB + k=5 + 거리 0.4m 조합은:
- **도메인 적응**: bokdo3 데이터 특성에 맞춤
- **균형점**: 모든 파라미터의 실용적 중간값
- **LiDAR 인접 보존**: 도메인 차이로 인한 문제 해결
- **실용적 성능**: 과도하지 않은 적절한 보존율

## 🔄 **향후 활용**
이 균형잡힌 모델은:
- 도메인 차이가 있는 환경에서의 기준 모델
- 실제 배포 환경에서의 실용적 선택
- 다양한 SNR 분포를 가진 데이터에 적응 가능
